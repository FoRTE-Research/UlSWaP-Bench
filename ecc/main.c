/** need to choose which ECC implementation to run **/
//#define BSD
#define TINY_ECC
//#define MBEDTLS

/** need to uncomment if the board you are using is MSP432P401R **/
//#define msp432p401r
//#define msp430g2553
// #define msp430fr5994
//#define riscv

#include <assert.h>
#include <stdio.h>
#include <stdint.h>
#include "curve.h"

#if defined(TINY_ECC)
#include "ecdh.h"
#elif defined(BSD)
#include "bsd/uECC.h"
#elif defined(MBEDTLS)
#include "mbedtls/ecc_test.h"
#endif

#ifdef msp432p401r
#include "msp.h"
#include "rom_map.h"
#include "rom.h"
#include "systick.h"
#endif

#ifdef msp430g2553
#include "msp430.h"
#endif

#ifdef msp430fr5994
#include "msp430.h"
#endif

// #include "experiment_time.h"

#if defined(TINY_ECC)
#define ECC_PUB_SIZE ECC_PUB_KEY_SIZE
#define ECC_PRV_SIZE ECC_PRV_KEY_SIZE
#elif defined(BSD)
#define ECC_PUB_SIZE 64
 #define ECC_PRV_SIZE 32
#elif defined(MBEDTLS)

#endif

#if defined(TINY_ECC) || defined(BSD)
uint8_t pub_a[ECC_PUB_SIZE];
uint8_t prv_a[ECC_PRV_SIZE];
uint8_t sec_a[ECC_PUB_SIZE];
uint8_t pub_b[ECC_PUB_SIZE];
uint8_t prv_b[ECC_PRV_SIZE];
uint8_t sec_b[ECC_PUB_SIZE];
uint32_t i;
const struct uECC_Curve_t * curves;
#endif

#if defined(MBEDTLS)
//private key
unsigned char private_a[BUF_BYTES];
unsigned char private_b[BUF_BYTES];
//public key  (x, y)
unsigned char cli_to_srv_x[BUF_BYTES];
unsigned char cli_to_srv_y[BUF_BYTES];
unsigned char srv_to_cli_x[BUF_BYTES];
unsigned char srv_to_cli_y[BUF_BYTES];
#endif

void init_ecc() {
#if defined(TINY_ECC)
    #if   (ECC_CURVE == NIST_K163) || (ECC_CURVE == NIST_B163)
    uint8_t temp_prv_a[ECC_PRV_SIZE] = {0x2F,0x46,0x53,0xB8,0x26,0x67,0x5E,0x49,0x72,0x6B,0x53,0xE4,0x99,0x55,0x09,0x99,0xBE,0x39,0x47,0x60,0x02,0x00,0x00,0x00};
    uint8_t temp_prv_b[ECC_PRV_SIZE] = {0x8F,0x69,0x8F,0x5A,0x1D,0xC2,0x2D,0x84,0x3E,0xC0,0x0C,0xAF,0x89,0x04,0x52,0x39,0x97,0x7D,0x51,0x4F,0x02,0x00,0x00,0x00};
    uint8_t temp_pub_a[ECC_PUB_SIZE] = {0x55,0x62,0x95,0xC4,0xE6,0xCA,0x69,0x7A,0x8D,0x82,0xBF,0xCC,0xDA,0xD2,0x22,0xCA,0x2A,0xA2,0xA3,0x5D,0x02,0x00,0x00,0x00,0xB5,0x58,0xD9,0x07,0x81,0x35,0xB5,0x19,0xDD,0x1A,0xFE,0x4A,0x0F,0xA2,0x83,0xB6,0x5D,0xC1,0xAC,0x67,0x03,0x00,0x00,0x00};
    uint8_t temp_pub_b[ECC_PUB_SIZE] = {0x55,0x04,0xB5,0x37,0x9A,0xFC,0x4A,0x86,0xE4,0xF6,0xDD,0xFA,0x89,0xBA,0x60,0x49,0xF1,0xE7,0xE9,0x0F,0x03,0x00,0x00,0x00,0x14,0xB8,0xA3,0xE0,0xE7,0xF0,0xC3,0xED,0x15,0x54,0x68,0xD9,0x2D,0x7C,0x56,0xEF,0x51,0x7F,0x44,0x2F,0x07,0x00,0x00,0x00};
    #elif (ECC_CURVE == NIST_K233) || (ECC_CURVE == NIST_B233)
    uint8_t temp_prv_a[ECC_PRV_SIZE] = {0x2F,0x46,0x53,0xB8,0x26,0x67,0x5E,0x49,0x72,0x6B,0x53,0xE4,0x99,0x55,0x09,0x99,0xBE,0x39,0x47,0x60,0xF2,0x91,0x87,0x1F,0x8F,0x69,0x8F,0x5A,0x1D,0x00,0x00,0x00};
        uint8_t temp_prv_b[ECC_PRV_SIZE] = {0x3E,0xC0,0x0C,0xAF,0x89,0x04,0x52,0x39,0x97,0x7D,0x51,0x4F,0xDA,0x58,0xAE,0x16,0xA9,0x63,0x74,0x67,0x94,0x93,0xB1,0xF7,0x66,0x7B,0x29,0x1C,0xCE,0x00,0x00,0x00};
        uint8_t temp_pub_a[ECC_PUB_SIZE] = {0xAF,0x08,0xF4,0x95,0x0A,0x27,0x5F,0x50,0x96,0x38,0x69,0x45,0x9D,0x40,0xDF,0x2B,0x25,0xA9,0x63,0x35,0xD4,0xAC,0x61,0x69,0x2D,0x3D,0x1F,0xE2,0x38,0x00,0x00,0x00,0x31,0xAE,0x94,0xD6,0x9C,0x7D,0xA4,0x44,0x67,0xC7,0x1E,0x66,0xD6,0x36,0x92,0x6F,0x8F,0x42,0xB9,0xBF,0x71,0xB4,0x4F,0x5B,0x41,0xAD,0xAA,0x86,0x82,0x01,0x00,0x00};
        uint8_t temp_pub_b[ECC_PUB_SIZE] = {0x70,0xF7,0x8E,0xB9,0x4E,0x59,0x98,0xF8,0xB3,0x3A,0x48,0xE2,0x3C,0x12,0x8A,0x9C,0x06,0xE9,0x34,0xD6,0xBC,0x32,0xAD,0xDC,0xFD,0x2D,0x03,0xA3,0xC7,0x00,0x00,0x00,0x77,0xAF,0xA1,0xA4,0x31,0x68,0xBA,0xF6,0x78,0x29,0xCB,0xA6,0xDC,0xA3,0x52,0x63,0xC0,0xAB,0x59,0x53,0x0C,0x74,0xEC,0x46,0x3E,0x20,0xDF,0x38,0x62,0x00,0x00,0x00};
     #elif (ECC_CURVE == NIST_K283) || (ECC_CURVE == NIST_B283)
        uint8_t temp_prv_a[ECC_PRV_SIZE] = {0x2F,0x46,0x53,0xB8,0x26,0x67,0x5E,0x49,0x72,0x6B,0x53,0xE4,0x99,0x55,0x09,0x99,0xBE,0x39,0x47,0x60,0xF2,0x91,0x87,0x1F,0x8F,0x69,0x8F,0x5A,0x1D,0xC2,0x2D,0x84,0x3E,0xC0,0x0C,0x01};
        uint8_t temp_prv_b[ECC_PRV_SIZE] = {0x89,0x04,0x52,0x39,0x97,0x7D,0x51,0x4F,0xDA,0x58,0xAE,0x16,0xA9,0x63,0x74,0x67,0x94,0x93,0xB1,0xF7,0x66,0x7B,0x29,0x1C,0xCE,0x0E,0x9C,0x30,0xB2,0x51,0xB2,0x5F,0x52,0xCD,0x6D,0x01};
        uint8_t temp_pub_a[ECC_PUB_SIZE] = {0x69,0xA6,0x4E,0xD8,0x31,0x16,0x63,0xD5,0x34,0xAA,0x31,0xC6,0xD1,0xF0,0xDF,0xB8,0x54,0x3D,0x33,0x61,0x81,0xAB,0x05,0x88,0x54,0x91,0x8A,0x55,0x82,0x92,0x5A,0x9D,0xB6,0x33,0x33,0x06,0x73,0xC7,0x5F,0xD6,0xD2,0x52,0xDA,0x22,0x31,0x90,0x2F,0xE0,0xF6,0x49,0x72,0x25,0x54,0xBA,0xAC,0x88,0xE0,0x0A,0xA5,0x3B,0x17,0x9F,0x0A,0x49,0xBF,0x0B,0x93,0x10,0x77,0x6D,0xF7,0x06};
        uint8_t temp_pub_b[ECC_PUB_SIZE] = {0x8C,0x90,0x69,0x3D,0x53,0xFE,0x52,0xA6,0x1E,0xDF,0x89,0x3B,0x65,0x60,0xE6,0x25,0x1E,0x8D,0x64,0x97,0xAE,0x52,0x2E,0xCD,0x45,0x3D,0x2A,0x05,0x50,0x5A,0x69,0x58,0x18,0xFC,0x03,0x05,0xBC,0x72,0xE8,0x6A,0x11,0x4C,0xC5,0x08,0x2D,0x4E,0x03,0x86,0xA3,0x26,0xCE,0xC9,0x9A,0xC9,0x13,0x55,0x5E,0xD1,0x10,0x2B,0xD7,0x15,0xFF,0x7C,0xC6,0x2B,0xAB,0x2F,0xA4,0x82,0xE9,0x03};
     #elif (ECC_CURVE == NIST_K409) || (ECC_CURVE == NIST_B409)
        uint8_t temp_prv_a[ECC_PRV_SIZE] = {0x2F,0x46,0x53,0xB8,0x26,0x67,0x5E,0x49,0x72,0x6B,0x53,0xE4,0x99,0x55,0x09,0x99,0xBE,0x39,0x47,0x60,0xF2,0x91,0x87,0x1F,0x8F,0x69,0x8F,0x5A,0x1D,0xC2,0x2D,0x84,0x3E,0xC0,0x0C,0xAF,0x89,0x04,0x52,0x39,0x97,0x7D,0x51,0x4F,0xDA,0x58,0xAE,0x16,0xA9,0x63,0x74,0x00};
        uint8_t temp_prv_b[ECC_PRV_SIZE] = {0x94,0x93,0xB1,0xF7,0x66,0x7B,0x29,0x1C,0xCE,0x0E,0x9C,0x30,0xB2,0x51,0xB2,0x5F,0x52,0xCD,0x6D,0xD3,0x74,0x53,0x07,0x49,0xFC,0xD3,0x61,0xE7,0x31,0xED,0x4E,0x92,0xFF,0x2D,0x12,0xF7,0x2C,0x01,0x29,0x2E,0xE4,0x60,0x0D,0x79,0x7E,0x1E,0xCE,0x93,0x7F,0x90,0xD7,0x00};
        uint8_t temp_pub_a[ECC_PUB_SIZE] = {0xA3,0x47,0x34,0x12,0x0E,0x47,0x9E,0xE7,0x59,0x50,0x0D,0xA8,0xA0,0xF9,0xEB,0x28,0x3E,0xE2,0x4B,0xFC,0x15,0x73,0x4F,0xCC,0xBB,0x14,0x78,0x97,0x72,0xE8,0x17,0x43,0x2D,0x83,0xBD,0x67,0x91,0x0A,0x7B,0xCC,0x45,0xE9,0x73,0x03,0x57,0xDD,0xE7,0x9F,0x1F,0x25,0xBE,0x00,0x4F,0x52,0x5E,0x0E,0x16,0xC4,0xBC,0xAF,0x29,0x01,0x7E,0xCA,0x89,0x07,0xE9,0xCC,0x66,0xFA,0xA2,0x56,0x31,0xED,0xCE,0x49,0xF1,0x62,0xF0,0x3F,0x52,0x53,0x39,0x9A,0x0D,0x7A,0x10,0x4E,0x24,0xCB,0x1A,0x3F,0x54,0xE7,0x60,0xFF,0x27,0x96,0xB1,0x05,0x79,0x9E,0x37,0x01};
        uint8_t temp_pub_b[ECC_PUB_SIZE] = {0x5F,0x47,0xF0,0xA4,0xD3,0x47,0xED,0xCF,0xD9,0x3E,0x11,0x91,0x09,0x91,0x31,0xA6,0xBA,0x13,0x62,0xC6,0xF6,0x14,0x82,0xD7,0x3D,0x0A,0xA1,0x5B,0x42,0xEA,0xBA,0x83,0xE1,0x19,0x3B,0xE2,0xEB,0xB3,0xC4,0x01,0xA4,0xB3,0x03,0x1C,0xEC,0xFD,0xF0,0x71,0x98,0xA4,0x21,0x01,0xD4,0x54,0x78,0xEA,0x70,0x50,0x6B,0xB6,0x5E,0x6B,0x85,0x0F,0x66,0x78,0x63,0x99,0x42,0x22,0x93,0xCC,0x89,0x77,0xEB,0x9E,0xD9,0x67,0x03,0x0A,0xE8,0xFC,0x5B,0xA3,0x42,0x14,0x20,0xAE,0x39,0x08,0xE5,0xFE,0x2A,0x39,0xD7,0xC8,0x41,0xC7,0xFA,0x26,0x5B,0xF5,0xDE,0x00};
     #elif (ECC_CURVE == NIST_K571) || (ECC_CURVE == NIST_B571)
        uint8_t temp_prv_a[ECC_PRV_SIZE] = {0x2F,0x46,0x53,0xB8,0x26,0x67,0x5E,0x49,0x72,0x6B,0x53,0xE4,0x99,0x55,0x09,0x99,0xBE,0x39,0x47,0x60,0xF2,0x91,0x87,0x1F,0x8F,0x69,0x8F,0x5A,0x1D,0xC2,0x2D,0x84,0x3E,0xC0,0x0C,0xAF,0x89,0x04,0x52,0x39,0x97,0x7D,0x51,0x4F,0xDA,0x58,0xAE,0x16,0xA9,0x63,0x74,0x67,0x94,0x93,0xB1,0xF7,0x66,0x7B,0x29,0x1C,0xCE,0x0E,0x9C,0x30,0xB2,0x51,0xB2,0x5F,0x52,0xCD,0x6D,0x01};
        uint8_t temp_prv_b[ECC_PRV_SIZE] = {0x74,0x53,0x07,0x49,0xFC,0xD3,0x61,0xE7,0x31,0xED,0x4E,0x92,0xFF,0x2D,0x12,0xF7,0x2C,0x01,0x29,0x2E,0xE4,0x60,0x0D,0x79,0x7E,0x1E,0xCE,0x93,0x7F,0x90,0xD7,0x77,0x93,0xDA,0x7C,0x7B,0xA5,0x66,0x70,0xF2,0x63,0xD6,0xA2,0x42,0x1F,0x0A,0x9E,0x31,0x75,0xB5,0x76,0x66,0x71,0x4C,0x93,0xD1,0xCC,0x26,0x9F,0xE6,0xB8,0x38,0x7B,0x4E,0x2D,0xB4,0x18,0x69,0xC5,0x77,0x9C,0x01};
        uint8_t temp_pub_a[ECC_PUB_SIZE] = {0xCA,0xF3,0x7F,0x9F,0x5C,0x8F,0xD5,0xF0,0x51,0xB3,0x8D,0x60,0xB7,0x97,0x14,0x78,0xBC,0xBC,0x09,0xD5,0x13,0xB8,0x23,0x0B,0xDB,0x43,0xC3,0x97,0xD2,0xDE,0x95,0x84,0x91,0xBE,0xA4,0x03,0x4D,0xBC,0xF3,0x73,0x8C,0x87,0xAD,0x68,0x05,0x84,0x8A,0xC9,0x83,0x1B,0xDB,0x52,0x67,0xB5,0xD2,0x6D,0x63,0x95,0xDF,0xA6,0x9F,0x77,0x99,0x1C,0x7F,0x70,0x00,0x7A,0xF5,0x6D,0x8B,0x01,0xDA,0x98,0x2C,0x0F,0x86,0xCD,0x6F,0x3E,0xE2,0x63,0x5A,0x16,0x93,0x98,0x74,0x83,0x40,0x76,0xD5,0x90,0x82,0x1D,0xD9,0x64,0xC1,0xAD,0x2D,0xAB,0x26,0xD9,0x28,0x7C,0xD4,0x79,0x61,0xF4,0xA8,0x5B,0x5E,0xA1,0xE7,0x96,0xBC,0x5B,0x6A,0x74,0xC3,0x54,0x12,0xD4,0xB1,0x52,0xE1,0xD5,0xFC,0x77,0x24,0x36,0xD4,0xA5,0x6A,0xFF,0x78,0x38,0x86,0x1F,0xCC,0x36,0x86,0xFD,0xA1,0x01};
        uint8_t temp_pub_b[ECC_PUB_SIZE] = {0xE4,0x7C,0x54,0x27,0x16,0x45,0xA5,0xB9,0x98,0x91,0xCA,0x7B,0x19,0x3B,0xC7,0xB5,0x25,0x7E,0x50,0x02,0x16,0x77,0x7C,0x82,0xF3,0x17,0x33,0x4E,0x12,0xC4,0x84,0x5F,0xE2,0x8D,0x12,0x57,0xE2,0x7A,0xBE,0x12,0x6A,0x84,0x56,0x02,0x53,0xE8,0xAC,0x63,0x74,0xAF,0x78,0x64,0xDF,0xC3,0x24,0xFA,0xF6,0x00,0x14,0x33,0x13,0xCC,0x8E,0x6A,0xC7,0x45,0xA7,0xD9,0xBB,0xCF,0x49,0x07,0xA6,0xDE,0xC0,0x44,0xF2,0x38,0x9D,0xA1,0x09,0xB6,0x43,0x97,0x45,0x15,0x1B,0x84,0x28,0xD6,0xF1,0x34,0xB2,0xD8,0xD0,0xB6,0xDB,0xE2,0x91,0x4B,0x99,0x8D,0xBB,0xFC,0x75,0x1A,0xCF,0x9A,0x02,0x07,0x29,0x63,0x3F,0xD0,0x31,0x89,0x7B,0x3C,0xBE,0xDD,0x18,0x3B,0x98,0x89,0xB4,0xE6,0x72,0x71,0xF0,0x6D,0xA3,0xAA,0xA5,0xB1,0xF2,0xF6,0x87,0x21,0xD2,0x4F,0x8F,0x6B,0xA9,0x03};
     #endif
    for(int i = 0; i < ECC_PRV_SIZE; i++) {
        prv_a[i] = temp_prv_a[i];
        prv_b[i] = temp_prv_b[i];
    }

    for(int i = 0; i < ECC_PUB_SIZE; i++) {
        pub_a[i] = temp_pub_a[i];
        pub_b[i] = temp_pub_b[i];
    }

#elif defined(BSD)
    #if uECC_SUPPORTS_secp160r1
        uint8_t temp_prv_a[ECC_PRV_SIZE] = {0x00 ,0x33 ,0x05 ,0xFA ,0xD2 ,0x12 ,0xCE ,0x9D ,0xC4 ,0xF1 ,0x6A ,0x43 ,0xE3 ,0xBD ,0x20 ,0x2E ,0x94 ,0x99 ,0xBE ,0x4D ,0xC2 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00};
        uint8_t temp_prv_b[ECC_PRV_SIZE] = {0x00 ,0x51 ,0xD3 ,0x0D ,0x39 ,0x0B ,0xB3 ,0xB8 ,0xF5 ,0x9E ,0xA4 ,0xCA ,0x63 ,0x1B ,0x19 ,0x72 ,0x0E ,0x75 ,0x98 ,0x29 ,0x0A ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00};
        uint8_t temp_pub_a[ECC_PUB_SIZE] = {0x88 ,0x56 ,0x69 ,0x37 ,0x2F ,0xF3 ,0x68 ,0x3A ,0x8B ,0x14 ,0x38 ,0x8B ,0xA6 ,0xD0 ,0x14 ,0x09 ,0x3E ,0xC1 ,0xBC ,0x19 ,0xC9 ,0xED ,0x39 ,0x89 ,0x4E ,0xA7 ,0x41 ,0x81 ,0xE1 ,0x87 ,0x63 ,0x44 ,0xE4 ,0x74 ,0x6F ,0x0D ,0x7D ,0xFF ,0xE4 ,0xEC ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00};
        uint8_t temp_pub_b[ECC_PUB_SIZE] = {0x0B ,0x50 ,0x18 ,0xCB ,0x09 ,0x9C ,0x5C ,0xA1 ,0xBC ,0xFF ,0x92 ,0x08 ,0xC7 ,0x56 ,0x41 ,0xC1 ,0xEA ,0x52 ,0xCB ,0x07 ,0xA0 ,0xF6 ,0xDE ,0x93 ,0x66 ,0xD9 ,0x8A ,0x26 ,0x71 ,0xBC ,0xFC ,0xD1 ,0xE8 ,0x00 ,0x6A ,0xB1 ,0xED ,0x9C ,0x54 ,0xAA ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00};
    #elif uECC_SUPPORTS_secp192r1
        uint8_t temp_prv_a[ECC_PRV_SIZE] = {0xb1, 0x9a, 0x93, 0x78, 0xff, 0x7e,  0x72, 0x41, 0x9c, 0x37, 0xbc, 0x32, 0x5e, 0xb4, 0x3c, 0x9b, 0xa, 0x8d, 0x9f, 0x9b, 0x5e, 0x27, 0x80, 0x97, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0};
        uint8_t temp_prv_b[ECC_PRV_SIZE] = {0xf0, 0x38, 0xdd, 0x9b, 0x2c, 0xae,  0xce, 0x44, 0xe2, 0xa6, 0xda, 0x9d, 0x3b, 0x1e,  0x86, 0xef, 0xa2, 0x44, 0xe1, 0x6b, 0x6e, 0x9a, 0xd5, 0x10, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0};
        uint8_t temp_pub_a[ECC_PUB_SIZE] = {0xbf, 0x65, 0xd4, 0xee, 0xc7, 0x6a,  0x54, 0xa3, 0xc4, 0xa7, 0x71, 0xf8, 0x0, 0x10,  0x3a, 0xfc, 0x67, 0x84, 0x22, 0x87, 0x2b, 0x43,  0xbb, 0xe4, 0x42, 0x20, 0x16, 0x35, 0xc8, 0x2b,  0x4f, 0x21, 0x25, 0x3e, 0x2b, 0xd6, 0x8c, 0x9e,  0xe3, 0x22, 0xb1, 0x76, 0x31, 0x92, 0x92, 0xa7,  0x7f, 0x34, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,  0x0, 0x0};
        uint8_t temp_pub_b[ECC_PUB_SIZE] = {0x88, 0xcf, 0xef, 0x8c, 0x1f, 0x77,  0x7f, 0x44, 0xe, 0x3b, 0x71, 0xf, 0xd2, 0x21,  0x6a, 0x88, 0x66, 0x1c, 0x17, 0x1d, 0x5f, 0x4e,  0x5b, 0x6, 0x5, 0x30, 0xed, 0x86, 0x6, 0x93,  0x87, 0x2f, 0x4a, 0x9c, 0xba, 0x5c, 0xa8, 0x87,  0x20, 0x25, 0x74, 0x4, 0x12, 0xa8, 0xaa, 0xa6,  0xb1, 0xce, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,  0x0, 0x0};
    #elif uECC_SUPPORTS_secp224r1
        uint8_t temp_prv_a[ECC_PRV_SIZE] = {0xA5 ,0x93 ,0xDC ,0xA7 ,0x8C ,0xAA ,0x6A ,0xFF ,0xEE ,0xCE ,0xA2 ,0x35 ,0x61 ,0xB6 ,0x2B ,0xEB ,0x66 ,0x3C ,0x36 ,0xCB ,0x43 ,0x87 ,0x7A ,0x74 ,0xEC ,0x9F ,0xAC ,0x77 ,0x00 ,0x00 ,0x00 ,0x00};
        uint8_t temp_prv_b[ECC_PRV_SIZE] = {0xA6 ,0x83 ,0xC3 ,0x6D ,0xAE ,0x08 ,0x9B ,0x27 ,0x8F ,0xF6 ,0xF7 ,0x36 ,0x6D ,0x57 ,0x1C ,0x56 ,0xFF ,0x07 ,0x4F ,0xF9 ,0xAF ,0x91 ,0x23 ,0x7E ,0x2F ,0x9A ,0xFC ,0xC4 ,0x00 ,0x00 ,0x00 ,0x00};
        uint8_t temp_pub_a[ECC_PUB_SIZE] = {0x66 ,0xA8 ,0x54 ,0xFA ,0x50 ,0xAC ,0xAA ,0x2E ,0x17 ,0x64 ,0x18 ,0xD2 ,0x74 ,0xDB ,0xDF ,0x1B ,0xB0 ,0xCA ,0xDA ,0x1C ,0x12 ,0x50 ,0xDD ,0x67 ,0xA4 ,0xA0 ,0x73 ,0x04 ,0x42 ,0x54 ,0x95 ,0xDE ,0xA9 ,0x73 ,0x9D ,0x04 ,0x36 ,0xB0 ,0xD0 ,0x3A ,0xAC ,0xB5 ,0x7D ,0x1B ,0x79 ,0xEB ,0x47 ,0x86 ,0xC2 ,0x65 ,0x42 ,0x41 ,0xCA ,0x12 ,0xC1 ,0xB4 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00};
        uint8_t temp_pub_b[ECC_PUB_SIZE] = {0xF9 ,0x9A ,0x59 ,0x89 ,0x66 ,0x5A ,0xA3 ,0x8F ,0x34 ,0x5E ,0xDC ,0xE5 ,0xD6 ,0xF1 ,0x39 ,0x96 ,0x86 ,0x45 ,0x4B ,0x6B ,0x74 ,0x2F ,0x11 ,0xB2 ,0x55 ,0xF1 ,0x55 ,0x47 ,0xB6 ,0x1E ,0xB1 ,0x4B ,0x2C ,0x2E ,0xB8 ,0x2A ,0xE0 ,0x49 ,0xA9 ,0xED ,0x4F ,0x9E ,0x76 ,0xB3 ,0xE9 ,0x38 ,0x37 ,0x8F ,0x7B ,0xD3 ,0xFA ,0xC5 ,0xE1 ,0x0C ,0x0A ,0xAF ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00};
    #elif uECC_SUPPORTS_secp256r1
        uint8_t temp_prv_a[ECC_PRV_SIZE] = {0x31 ,0xA1 ,0x27 ,0xAD ,0xB9 ,0x73 ,0xB8 ,0x6A ,0x40 ,0x81 ,0x68 ,0x69 ,0x48 ,0xBE ,0xBB ,0x3D ,0xAD ,0x08 ,0x58 ,0xC4 ,0xA6 ,0xE4 ,0x1C ,0xC2 ,0xCE ,0x28 ,0xD2 ,0xBD ,0x3C ,0x31 ,0xCB ,0xA7};
        uint8_t temp_prv_b[ECC_PRV_SIZE] = {0x34 ,0x87 ,0x4B ,0xD8 ,0x6B ,0xE7 ,0x81 ,0x68 ,0xF5 ,0xEA ,0x03 ,0xC3 ,0x12 ,0x38 ,0x50 ,0x64 ,0x2A ,0xDB ,0x9D ,0x86 ,0x17 ,0x21 ,0x97 ,0x58 ,0x80 ,0xA1 ,0x24 ,0xAA ,0x83 ,0xD7 ,0x75 ,0x39};
        uint8_t temp_pub_a[ECC_PUB_SIZE] = {0x25 ,0x49 ,0x72 ,0xCF ,0x48 ,0x2B ,0x3E ,0x19 ,0x56 ,0x48 ,0xB4 ,0x00 ,0xD6 ,0x48 ,0xAD ,0x90 ,0x35 ,0xEC ,0x83 ,0x2F ,0x9D ,0x9C ,0xD5 ,0x05 ,0x2D ,0x0D ,0xD1 ,0x95 ,0xAA ,0xDC ,0x19 ,0xAB ,0x1B ,0xF9 ,0x2B ,0xB4 ,0xA8 ,0xE5 ,0xD6 ,0x78 ,0x6E ,0x4F ,0xB1 ,0xF1 ,0xCD ,0x0F ,0xDE ,0xCF ,0x35 ,0xEF ,0x7F ,0x86 ,0xCB ,0x94 ,0x64 ,0xC9 ,0xE5 ,0x11 ,0xCB ,0x17 ,0xF4 ,0x65 ,0x05 ,0xFB};
        uint8_t temp_pub_b[ECC_PUB_SIZE] = {0xB1 ,0x8E ,0x9E ,0x98 ,0xF5 ,0x8D ,0xFE ,0xE4 ,0x39 ,0xB2 ,0xC4 ,0x60 ,0x80 ,0xDA ,0xAA ,0xC8 ,0x9B ,0xA7 ,0xA6 ,0x66 ,0x71 ,0x84 ,0x0D ,0x03 ,0x05 ,0x1E ,0x9F ,0x8D ,0xD1 ,0xA6 ,0xE6 ,0x2C ,0xFB ,0xD6 ,0x75 ,0xB5 ,0x58 ,0x23 ,0x77 ,0x3E ,0xF8 ,0xF9 ,0x11 ,0x2D ,0xFC ,0x47 ,0x6E ,0x69 ,0x0A ,0x21 ,0xC4 ,0x7D ,0x0D ,0x49 ,0xB7 ,0x10 ,0xB6 ,0xD2 ,0xC5 ,0xF7 ,0x56 ,0xCA ,0xE7 ,0x09};
    #elif uECC_SUPPORTS_secp256k1
        uint8_t temp_prv_a[ECC_PRV_SIZE] = {0x4A ,0xE5 ,0xD8 ,0x76 ,0x2D ,0x40 ,0x61 ,0xBD ,0x0A ,0x5A ,0xB4 ,0x82 ,0x8E ,0x59 ,0x40 ,0x7E ,0x82 ,0x5D ,0x8F ,0x00 ,0xC0 ,0x52 ,0x94 ,0x2A ,0x96 ,0x6F ,0x8D ,0x06 ,0xE9 ,0x41 ,0x0D ,0xC8};
        uint8_t temp_prv_b[ECC_PRV_SIZE] = {0x0A ,0x76 ,0x4B ,0x66 ,0x68 ,0xDF ,0xFC ,0xF4 ,0x27 ,0x57 ,0x3D ,0x01 ,0xC4 ,0xE7 ,0xBB ,0x4E ,0x73 ,0x9D ,0x87 ,0x22 ,0xEC ,0xA6 ,0xCC ,0x12 ,0x4A ,0x49 ,0x77 ,0xBC ,0xCF ,0x36 ,0x94 ,0xC4};
        uint8_t temp_pub_a[ECC_PUB_SIZE] = {0xDC ,0xE4 ,0x62 ,0x17 ,0x1A ,0xE5 ,0x27 ,0x9E ,0x61 ,0xD4 ,0xE8 ,0x9C ,0xB3 ,0xC1 ,0x56 ,0x65 ,0x43 ,0x8B ,0x4B ,0x44 ,0xFC ,0x8C ,0x0A ,0x2F ,0x11 ,0x67 ,0x79 ,0x7E ,0xCE ,0x25 ,0x24 ,0xCB ,0x8A ,0x00 ,0x23 ,0x74 ,0x9E ,0x07 ,0x2E ,0xB5 ,0xBF ,0xBC ,0x59 ,0x2D ,0xF5 ,0x93 ,0xDA ,0x71 ,0x90 ,0x7C ,0x75 ,0xC8 ,0x1E ,0x50 ,0xBD ,0x1B ,0x82 ,0x0B ,0x18 ,0xC6 ,0xAF ,0x1D ,0xBB ,0x20};
        uint8_t temp_pub_b[ECC_PUB_SIZE] = {0x33 ,0x02 ,0xF7 ,0xD0 ,0xE9 ,0xB7 ,0x03 ,0xA6 ,0xB6 ,0xC8 ,0xCD ,0x6E ,0x73 ,0xA7 ,0x46 ,0x70 ,0xDE ,0x27 ,0xBB ,0xF5 ,0x4F ,0x44 ,0xAA ,0x35 ,0x80 ,0x24 ,0x28 ,0x5B ,0x20 ,0x1D ,0xAA ,0x95 ,0xA0 ,0x39 ,0xF7 ,0x41 ,0x4A ,0xF2 ,0x3E ,0xA3 ,0xFC ,0x08 ,0x5F ,0x28 ,0x7E ,0x2C ,0x31 ,0xAB ,0x9D ,0xAA ,0x74 ,0xE0 ,0xA1 ,0x30 ,0xFB ,0xBB ,0x12 ,0x4B ,0x13 ,0xC8 ,0x72 ,0x35 ,0x1C ,0xAE};
    #endif
    int i = 0;
    for(i = 0; i < ECC_PRV_SIZE; i++) {
        prv_a[i] = temp_prv_a[i];
        prv_b[i] = temp_prv_b[i];
    }

    for(i = 0; i < ECC_PUB_SIZE; i++) {
        pub_a[i] = temp_pub_a[i];
        pub_b[i] = temp_pub_b[i];
    }
#elif defined(MBEDTLS)
#if CURVE25519
    /**MBEDTLS_ECP_DP_CURVE25519**/
        //private key
        unsigned char private_a[BUF_BYTES] = {0x6e,0x68,0xf2,0xf7,0x6f,0x37,0xdf,0x5,0x23,0x76,0x89,0xa4,0x4a,0xb5,0xd0,0xb6,0x8b,0x29,0x8c,0x97,0xb4,0x93,0xf6,0xa9,0x38,0x2d,0xc0,0x41,0x50,0xf2,0x21,0x40};
        unsigned char private_b[BUF_BYTES] = {0x42,0xf3,0x69,0x48,0xd1,0xb0,0xb1,0xab,0xdd,0x71,0x1d,0xfc,0x68,0x47,0xcc,0x88,0x1a,0x5e,0x2c,0x22,0x92,0xbc,0x1f,0x5b,0xd,0x4a,0x9a,0x3d,0x5e,0x36,0x29,0x70};
        //public key  (x, y)
        unsigned char cli_to_srv_x[BUF_BYTES] = {0x47,0x5c,0xaf,0xae,0xd8,0xcf,0x2f,0x3b,0x1e,0x79,0xcb,0xe,0xcb,0xa3,0xb3,0x7b,0x41,0x67,0x7e,0xa0,0x9a,0x56,0x75,0xe5,0xc6,0xc9,0x37,0xf9,0x21,0x8d,0x43,0xc4};
        unsigned char cli_to_srv_y[BUF_BYTES] = {0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0};
        unsigned char srv_to_cli_x[BUF_BYTES] = {0x4d,0xd,0x98,0xd1,0x99,0xcd,0xe3,0x16,0x1a,0x1,0x17,0xfe,0xb9,0xda,0x7e,0x87,0xef,0x3d,0x76,0x8,0x68,0xd0,0xca,0x49,0x76,0x8e,0xa7,0x2c,0x6e,0xb5,0xf,0x8};
        unsigned char srv_to_cli_y[BUF_BYTES] = {0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0};
#elif  SECP384R1
    /**MBEDTLS_ECP_DP_SECP384R1**/
        //private key
        unsigned char private_a[BUF_BYTES] = {0xd,0x44,0x59,0x3c,0xe4,0xed,0x22,0xc9,0x31,0x6c,0xb7,0xc2,0xf3,0x7,0x6d,0x49,0x26,0xdc,0x61,0xe0,0xd9,0x2,0xf2,0xbc,0xec,0xe6,0xf2,0x95,0xab,0xd9,0x9,0x5f,0x2a,0x6a,0x67,0xce,0x4c,0x11,0xcd,0x79,0x41,0x89,0x35,0xa2,0xbf,0x4b,0x95,0x45};
        unsigned char private_b[BUF_BYTES] = {0x91,0xca,0x8a,0x99,0x16,0x56,0x95,0x29,0xd5,0x98,0xb7,0x6,0x21,0xc1,0xb,0x61,0x1a,0x9,0xcd,0x3f,0x85,0xd6,0x85,0x29,0xc2,0xd8,0x3f,0xd,0x19,0xda,0xb6,0xa9,0x8,0xdf,0x42,0x3a,0x9c,0x30,0x43,0xcd,0x64,0xae,0xe0,0xd,0x9d,0x4a,0x33,0x67};
        //public key  (x, y)
        unsigned char cli_to_srv_x[BUF_BYTES] = {0x82,0x3f,0xeb,0xf8,0x71,0x2f,0xa2,0xfd,0x2d,0xab,0x78,0x70,0x68,0x82,0x87,0x3b,0x23,0x74,0xed,0x7,0x20,0x77,0x82,0x44,0xa6,0x2c,0xe,0x88,0x42,0xfc,0x17,0x5d,0xdb,0x5e,0xaa,0x60,0x81,0xb9,0xd9,0x1d,0xc5,0xec,0x5f,0xdf,0x13,0x9e,0x32,0x91};
        unsigned char cli_to_srv_y[BUF_BYTES] = {0xaf,0x61,0xb1,0xb7,0xff,0xe4,0x6a,0x60,0xe4,0xfc,0x84,0x2c,0x77,0xf6,0x1f,0xb6,0x42,0xc4,0x5d,0xf0,0x6b,0x3,0x80,0x1b,0x92,0xd4,0x95,0xb9,0xd3,0xa0,0xe8,0x87,0xc,0x3d,0x8,0xa9,0xae,0x11,0x7d,0x95,0x8b,0x54,0xdb,0x2,0xa3,0x80,0x82,0xfa};
        unsigned char srv_to_cli_x[BUF_BYTES] = {0xd1,0x53,0xb7,0x82,0x22,0xf2,0x6d,0xda,0x54,0x45,0x4b,0x19,0x10,0xd0,0x2,0x73,0x23,0x54,0x64,0x41,0x23,0xe5,0x5b,0xed,0x30,0x8,0xdc,0x9d,0xfb,0xdc,0xc2,0xf5,0x2b,0x30,0xbe,0x60,0x78,0x17,0xb7,0x35,0xff,0x48,0x45,0x68,0xf2,0x27,0x6a,0x6c};
        unsigned char srv_to_cli_y[BUF_BYTES] = {0xc3,0x63,0xdb,0x2,0xe8,0xb3,0x31,0x19,0xae,0x7a,0x7a,0x39,0x92,0xcd,0x30,0xa0,0x65,0x64,0x8f,0x16,0x2b,0x8,0x10,0x6e,0x5d,0x63,0xfa,0x5c,0xe0,0xcc,0xe8,0x6a,0xf,0x4d,0x3f,0x1f,0x3e,0x64,0xb,0xed,0xec,0xec,0x80,0xcb,0x8,0xd2,0x6e,0x33};
#elif SECP521R1
    /**MBEDTLS_ECP_DP_SECP521R1**/
        //private key
        unsigned char private_a[BUF_BYTES] = {0x0,0x0,0x8b,0xce,0x3a,0x75,0x2e,0x12,0x8e,0xcd,0x0,0x88,0x37,0x43,0x2a,0x8,0xd8,0x85,0xa2,0xc6,0xaf,0xcd,0x53,0xa7,0x36,0x5f,0x58,0x1a,0xbe,0x63,0x96,0xb7,0x92,0xa6,0x89,0x38,0xa0,0x5d,0x21,0x49,0x90,0xe4,0x4c,0x70,0x93,0x8,0xe4,0x76,0xbc,0x74,0x7e,0x3c,0xd4,0xad,0xa6,0xfc,0x16,0x77,0xab,0xe3,0x6f,0x2e,0x6a,0xb4,0x59,0x66};
        unsigned char private_b[BUF_BYTES] = {0x0,0xd8,0x4d,0xa0,0xd8,0x82,0xc1,0xf5,0xc3,0x6f,0x46,0x5b,0x9d,0x5f,0xf,0x54,0xf6,0x19,0x6a,0x1d,0xc5,0x34,0x4d,0x3c,0xa0,0xe3,0xc4,0x33,0x5d,0x82,0xee,0xa2,0x21,0x42,0xac,0x87,0x95,0x3a,0x8,0x98,0x71,0x12,0x66,0xbc,0xf5,0xec,0x2a,0xe3,0xda,0x7f,0x43,0x3e,0xca,0xbc,0xf8,0x28,0x9a,0x75,0x6,0x57,0x9e,0x85,0xed,0xc2,0xd,0x79};
        //public key  (x, y)
        unsigned char cli_to_srv_x[BUF_BYTES] = {0x1,0x1f,0x2e,0xb,0x5f,0xaf,0x5c,0x74,0x44,0xaf,0x26,0x37,0xa8,0xac,0x54,0x6a,0x9d,0x4f,0x6,0xdd,0x7,0x8a,0x24,0xda,0x66,0xb5,0xfb,0x67,0x43,0x3a,0x3b,0x32,0xa9,0xf0,0x9f,0xf8,0xa9,0x22,0x35,0x6a,0xf7,0xc9,0x22,0x71,0x6c,0x83,0x92,0x11,0x4a,0x94,0x24,0x2e,0xa5,0xf9,0x7a,0xc4,0x5d,0xcc,0xdf,0x0,0x8e,0xb0,0x5c,0x2d,0x75,0xb3};
        unsigned char cli_to_srv_y[BUF_BYTES] = {0x1,0x87,0x8a,0x1a,0xd5,0x31,0x61,0xb0,0x36,0xd3,0x67,0x77,0xeb,0x40,0xfc,0x7,0xa4,0x7e,0x61,0x1f,0x82,0xc0,0x62,0x7b,0xfd,0xc0,0x63,0x92,0x57,0x21,0xdb,0xd9,0xd8,0xb,0x2b,0x36,0x4e,0x13,0xd2,0xeb,0x13,0x9,0xcb,0x76,0xdd,0x8b,0x3b,0xaa,0x18,0x38,0xaa,0x43,0x4e,0x7b,0xc,0x5b,0x11,0xe,0x28,0x61,0xa8,0x4b,0x16,0xa3,0x37,0xf3};
        unsigned char srv_to_cli_x[BUF_BYTES] = {0x1,0xb3,0x1,0x37,0x3b,0x53,0x7b,0xb6,0x7b,0xaa,0xeb,0xf7,0x69,0xa6,0x85,0x7,0x33,0x60,0xe2,0xf0,0xe6,0xe4,0xfd,0xc9,0xb,0x27,0x9a,0x59,0xf4,0x77,0x6b,0xac,0x29,0xd2,0xa,0x29,0xef,0x31,0x6d,0x3a,0x7a,0xc6,0x99,0x53,0xd3,0x9,0x22,0xb2,0xb4,0x58,0xb,0xa7,0x3f,0xa7,0xc7,0x6b,0x70,0xc0,0xa2,0x2,0xb0,0xf,0x5f,0x61,0xa8,0xc7};
        unsigned char srv_to_cli_y[BUF_BYTES] = {0x1,0xfe,0xe4,0x84,0x50,0x75,0xb9,0x6b,0x96,0xc4,0xa1,0x4b,0x68,0xd3,0x8c,0xbf,0x5c,0x56,0x65,0xd7,0xea,0xb0,0xa2,0xc8,0xa7,0xe2,0xfb,0xdf,0xb5,0x17,0xcc,0xb3,0x75,0xf1,0x56,0x61,0x61,0x6e,0xb7,0xcc,0x92,0x73,0x77,0xc3,0x66,0xa5,0xa7,0x2a,0x30,0x1a,0x52,0x83,0xaf,0x2e,0x17,0x19,0x17,0x43,0x72,0x76,0xdb,0xdc,0xb2,0x47,0x1b,0x1c};
#endif

    mbedtls_init(private_a, private_b, cli_to_srv_x, cli_to_srv_y, srv_to_cli_x, srv_to_cli_y);
#endif
}

void generate_share_secret(){
#if defined(TINY_ECC)
    ecdh_shared_secret(prv_a, pub_b, sec_a);
#elif defined(BSD)
    #if uECC_SUPPORTS_secp160r1
        curves = uECC_secp160r1();
    #endif
    #if uECC_SUPPORTS_secp192r1
        curves = uECC_secp192r1();
    #endif
    #if uECC_SUPPORTS_secp224r1
        curves = uECC_secp224r1();
    #endif
    #if uECC_SUPPORTS_secp256r1
        curves = uECC_secp256r1();
    #endif
    #if uECC_SUPPORTS_secp256k1
        curves = uECC_secp256k1();
    #endif

    if (!uECC_shared_secret(pub_b, prv_a, sec_a, curves)) {
        printf("shared_secret() failed (1)\n");
        return;
    }
#elif defined(MBEDTLS)
    mbedtls_compute_shared();
#endif
}

int check_result() {

#if defined(TINY_ECC)
    ecdh_shared_secret(prv_b, pub_a, sec_b);
#elif defined(BSD)
    if (!uECC_shared_secret(pub_a, prv_b, sec_b, curves)) {
        return 1; // shared_secret() failed
    }
#endif
#if defined(TINY_ECC) || defined(BSD)
    for (i = 0; i < ECC_PUB_SIZE; ++i)
    {
        if (!(sec_a[i] == sec_b[i])) {
            return 1;
        }
    }
    return 0;
#endif
#if defined(MBEDTLS)
    return mbedtls_check_result();
#endif
}

int main(void) {
 
#if defined msp432p401r || defined msp430fr5994
    /** Initialize the board **/
    board_init();

    /** Starting the timer to measure elapsed time **/
    startTimer();
#endif

    init_ecc();
    generate_share_secret();

    // Print shared secret
    printf("Shared Secret A:\r\n");
    for (i = 0; i < ECC_PUB_SIZE; ++i)
    {
        printf("%02x ", sec_a[i]);
    }
    printf("\r\n");

   volatile unsigned int verify = check_result();
    if(verify == 0) {
         printf("Success\r\n");
    } else {
         printf("Failed\r\n");
    }


#if defined msp432p401r || defined msp430fr5994
    volatile unsigned int elapsed = getElapsedTime();
#endif

    return 0;
}
